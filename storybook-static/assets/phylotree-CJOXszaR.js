import{a as u,t as v,c as ie}from"./template-CIKGjA4E.js";import{p as se,f as j,b as le,s as A,g as p,ad as oe,c as g,m as q,e as E}from"./runtime-CsLX-Eqq.js";import{i as ce,e as F}from"./store-CEga9lFI.js";import{i as P}from"./if-BJwBTplU.js";import{c as G}from"./input-e_bUZ-Vg.js";import{b as de}from"./this-BvMMnuCv.js";import{p as y}from"./props-ucnq1n3h.js";import{c as pe,o as he,a as ue}from"./index-client-C32oe8zx.js";import{o as ye,s as fe,P as R,a as ge,b as ve}from"./GardVisualization-BErLMUnZ.js";var me=v('<link rel="stylesheet" href="https://unpkg.com/phylotree@1.0.0-alpha.24/dist/phylotree.css">'),be=v('<div class="hyphy-scope-container svelte-fv6rld"><!></div>'),_e=v('<div class="text-gray-500 p-4">Loading HyPhy-Scope viewer...</div>'),we=v('<div class="tree-container"></div>'),ke=v('<!> <div class="viewer-controls mb-3 svelte-fv6rld"><label class="text-sm text-gray-700">Tree Viewer:</label> <div class="mt-1"><label class="mr-4"><input type="radio" class="mr-1"> HyPhy-Scope</label> <label><input type="radio" class="mr-1"> Phylotree</label></div></div> <!>',1);function Te(U,o){se(o,!1);const V=[];let h=y(o,"newickString",8),B=y(o,"height",8,600),C=y(o,"width",8,800),S=y(o,"branchTestMode",8,!0),m=y(o,"selectedBranches",28,()=>[]),c=y(o,"viewerType",12,"hyphy-scope"),d=q(),l,s,n=[],z=0,x=q(null);const N=ye(fe),b=pe();he(()=>{_()}),ue(()=>{h()&&_()});function W(e){try{if(!e||e.trim()==="")return null;const t=new R(e);return{input:{trees:[{newick:e}]},trees:[{newick:e}],branch_attributes:{},tested:[]}}catch(t){return console.error("Error converting to hyphy-scope data:",t),null}}function I(e,t){try{if(!t||!n||n.length===0)return;let r=0,a=null;t.annotation?a=t.annotation:t.data&&t.data.annotation&&(a=t.data.annotation),a&&n.forEach(function(f,i){a===f&&(r++,e.style("fill",N(i),i===z?"important":null))}),r===0&&e.style("fill",null)}catch(r){console.error("Error in nodeColorizer:",r)}}function J(e,t){try{let r=0,a=null;t.target&&t.target.annotation?a=t.target.annotation:t.target&&t.target.data&&t.target.data.annotation?a=t.target.data.annotation:t.annotation&&(a=t.annotation),a&&n.length>0&&n.forEach(function(f,i){a===f&&(r++,e.style("stroke",N(i),i===z?"important":null))}),r>1?e.classed("branch-multiple",!0):r===0&&e.style("stroke",null).classed("branch-multiple",!1)}catch(r){console.error("Error in edgeColorizer:",r)}}function _(){try{if(!h()||h().trim()==="")return;c()==="hyphy-scope"?A(x,W(h())):K()}catch(e){console.error("Error in renderTree:",e)}}function K(){if(l=new R(h()),l.parsed_tags&&l.parsed_tags.length&&(n=[...l.parsed_tags],setTimeout(()=>{try{b("parsedtags",{parsed_tags:n})}catch(e){console.error("Error dispatching parsed tags:",e)}},0),S()))try{Y()}catch(e){console.error("Error updating branches from tags:",e)}s=l.render({container:".tree-container",height:B(),width:C(),"left-right-spacing":"fit-to-size","top-bottom-spacing":"fit-to-size","show-menu":!0,selectable:!0,collapsible:!0,reroot:!0,hide:!0,"node-styler":I,"edge-styler":J}),p(d)&&(oe(d,p(d).innerHTML=""),p(d).appendChild(s.show()),ge(p(d)).selectAll(".node").on("click",(e,t)=>{e.preventDefault(),s.handle_node_click(t,e),S()&&Q()}))}function O(e){const t=e.detail;t&&t.length&&(n=[...t],b("parsedtags",{parsed_tags:n}))}function Q(){if(s){const e=s.get_selection();m(e.map(r=>r.name||`node_${r.id}`));const t=X();b("branchselection",{selectedBranches:m(),taggedNewick:t})}}function X(){if(!s)return"";const e=s.get_selection(),t=n.length>0?n[0]:"TAG";return s.get_newick(r=>e.includes(r)?r.name+`{${t}}`:r.name)}function Y(){if(!l||!n.length)return;const e=[];function t(r){r.annotation&&n.includes(r.annotation)&&(e.push(r.name||`node_${r.id}`),s&&s.modify_selection(function(a){return a.name===r.name},"add",!0,!0)),r.children&&r.children.forEach(a=>t(a))}l.json&&t(l.json),m(e),b("branchselection",{selectedBranches:m(),taggedNewick:h()})}ce();var D=ke(),H=j(D);{var Z=e=>{var t=me();u(e,t)};P(H,e=>{c()==="phylotree"&&e(Z)})}var M=E(H,2),$=E(g(M),2),L=g($),w=g(L);w.value=(w.__value="hyphy-scope")==null?"":"hyphy-scope";var ee=E(L,2),k=g(ee);k.value=(k.__value="phylotree")==null?"":"phylotree";var te=E(M,2);{var re=e=>{var t=ie(),r=j(t);{var a=i=>{var T=be(),ne=g(T);ve(ne,{get width(){return C()},get height(){return B()},get data(){return p(x)},showLabels:!0,showScale:!0,isRadial:!1,$$events:{parsedtags:O}}),u(i,T)},f=i=>{var T=_e();u(i,T)};P(r,i=>{p(x)?i(a):i(f,!1)})}u(e,t)},ae=e=>{var t=we();de(t,r=>A(d,r),()=>p(d)),u(e,t)};P(te,e=>{c()==="hyphy-scope"?e(re):e(ae,!1)})}G(V,[],w,c,c),F("change",w,_),G(V,[],k,c,c),F("change",k,_),u(U,D),le()}Te.__docgen={version:3,name:"phylotree.svelte",data:[{name:"newickString",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"type",type:"any",text:"any"},static:!1,readonly:!1},{name:"height",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"number",text:"number"},static:!1,readonly:!1,defaultValue:"600"},{name:"width",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"number",text:"number"},static:!1,readonly:!1,defaultValue:"800"},{name:"branchTestMode",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"boolean",text:"boolean"},static:!1,readonly:!1,defaultValue:"true"},{name:"selectedBranches",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"array",text:"any[]"},static:!1,readonly:!1,defaultValue:"[]"},{name:"viewerType",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"string",text:"string"},static:!1,readonly:!1,defaultValue:'"hyphy-scope"'}],computed:[],methods:[],components:[],description:null,keywords:[],events:[{visibility:"public",description:null,keywords:[],name:"parsedtags"},{visibility:"public",description:"Dispatch the event with the tagged Newick (which is already tagged)",keywords:[],name:"branchselection"}],slots:[],refs:[]};export{Te as P};
