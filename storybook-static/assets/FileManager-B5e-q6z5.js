import{a as u,t as A,c as R,n as Y}from"./template-CIKGjA4E.js";import{p as Ce,s as c,g as e,l as W,a as Se,e as y,c as m,t as H,b as Ae,m as v,f as X,d as D}from"./runtime-CsLX-Eqq.js";import{i as C,s as S}from"./if-BJwBTplU.js";import{e as Me}from"./each--pBB4YgF.js";import{s as $e}from"./attributes-DOIZIB14.js";import{t as o}from"./class-BhzPnwhT.js";import{i as Ee,e as $,s as Pe,a as N}from"./store-CEga9lFI.js";import{b as Le}from"./input-e_bUZ-Vg.js";import{p as Ve}from"./props-ucnq1n3h.js";import{o as je}from"./index-client-C32oe8zx.js";import{p as f,c as Be}from"./fileInfo-DmhC3Ja7.js";import{a as T}from"./analyses-4ppeMcKn.js";import He from"./FileCard-CYhKxnln.js";import"./index-BJUjmB_L.js";var De=Y('<svg class="mr-1 h-4 w-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Ne=Y('<svg xmlns="http://www.w3.org/2000/svg" class="mr-1 h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>'),Te=A('<button class="flex items-center rounded-premium-sm bg-accent-warm px-premium-sm py-premium-xs text-premium-meta font-medium text-white transition-all duration-premium hover:bg-accent-copper disabled:cursor-not-allowed disabled:opacity-50"><!> </button>'),qe=A('<div class="absolute inset-0 z-10 flex items-center justify-center bg-white bg-opacity-90"><div class="text-center"><svg class="mx-auto mb-2 h-8 w-8 animate-spin text-accent-warm" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <p class="text-premium-body text-text-slate">Clearing all files...</p> <p class="mt-1 text-premium-meta text-text-silver">This may take a moment</p></div></div>'),Oe=A('<div class="flex items-center justify-center p-premium-md text-text-slate"><svg class="mr-premium-sm h-5 w-5 animate-pulse-premium text-brand-royal" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="text-premium-body">Loading files...</span></div>'),Ue=A('<p class="p-premium-md text-center text-premium-body text-text-slate"> </p>'),Ge=A('<div class="file-manager"><div class="mb-premium-md"><div class="mb-premium-sm flex items-center justify-between"><h2 class="text-premium-header font-semibold text-text-rich">Saved Files</h2> <!></div> <div class="mb-premium-sm flex flex-wrap items-center gap-premium-sm"><div class="relative flex-grow"><input type="text" placeholder="Search files..." class="w-full rounded-premium-sm border border-border-platinum py-premium-xs pl-8 pr-2 text-premium-meta"> <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-text-silver" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <div class="flex overflow-hidden rounded-premium-sm border border-border-platinum text-premium-meta"><button class="px-premium-sm py-premium-xs transition-all duration-premium"> </button> <button class="border-l border-border-platinum px-premium-sm py-premium-xs transition-all duration-premium"> </button> <button class="border-l border-border-platinum px-premium-sm py-premium-xs transition-all duration-premium"> </button></div></div></div> <div class="files-container relative max-h-96 overflow-y-auto rounded-premium border border-border-platinum"><!> <!></div></div>');function Je(Z,q){Ce(q,!1);const[E,I]=Pe(),k=()=>N(f,"$persistentFileStore",E),O=()=>N(T,"$analysisStore",E),ee=()=>N(Be,"$currentFile",E),P=v(),L=v();let te=Ve(q,"onSelectFile",8,()=>{}),h=v(new Map),re=v(new Set),s=v("date"),w=v("desc"),z=v(""),V=v(!0),x=v(!1);je(async()=>{c(V,!0);try{await f.loadFiles(),await ae()}catch(t){console.error("Error loading files:",t)}finally{c(V,!1)}});async function ae(){for(const t of k().files)if(!e(h).has(t.id))try{const r=await f.getFile(t.id),a=await se(r);e(h).set(t.id,a)}catch(r){console.error(`Error loading preview for ${t.filename}:`,r),e(h).set(t.id,"Preview unavailable")}}async function se(t){try{return(await t.text()).split(`
`).slice(0,5).join(`
`)}catch(r){return console.error("Error generating preview:",r),"Preview unavailable"}}function ie(t,r,a){return!t||!t.length?[]:[...t].sort((d,n)=>{let i=0;switch(r){case"name":i=(d.filename||"").localeCompare(n.filename||"");break;case"size":i=(d.size||0)-(n.size||0);break;case"date":default:i=(d.createdAt||0)-(n.createdAt||0);break}return a==="desc"?-i:i})}function le(t,r){if(!r)return t;const a=r.toLowerCase();return t.filter(d=>(d.filename||"").toLowerCase().includes(a))}function j(t){e(s)===t?c(w,e(w)==="asc"?"desc":"asc"):(c(s,t),c(w,"desc"))}async function oe(t){try{f.setCurrentFile(t);const r=await f.getFile(t);te()({isSelection:!0,fileId:t,file:r})}catch(r){console.error("Error selecting file:",r)}}async function ne(t){try{const r=O().analyses.filter(a=>a.fileId===t);for(const a of r)await T.deleteAnalysis(a.id);await f.deleteFile(t),e(h).delete(t),c(h,e(h))}catch(r){console.error("Error deleting file:",r)}}async function ce(){try{if(confirm("Are you sure you want to delete ALL files and their analyses? This cannot be undone.")){const t=k().files.map(a=>a.id);c(x,!0);const r=5;for(let a=0;a<t.length;a+=r){const d=t.slice(a,a+r);await Promise.all(d.map(async n=>{try{const i=O().analyses.filter(l=>l.fileId===n);await Promise.all(i.map(l=>T.deleteAnalysis(l.id).catch(p=>console.error(`Error deleting analysis ${l.id}:`,p)))),await f.deleteFile(n)}catch(i){console.error(`Error deleting file ${n}:`,i)}})),a+r<t.length&&await new Promise(n=>setTimeout(n,100))}c(h,new Map),await f.loadFiles(),f.setCurrentFile(null),c(x,!1)}}catch(t){console.error("Error clearing all files:",t),c(x,!1),alert("An error occurred while clearing files. Some files may not have been deleted.")}}W(()=>(k(),e(s),e(w)),()=>{c(P,ie(k().files,e(s),e(w)))}),W(()=>(e(P),e(z)),()=>{c(L,le(e(P),e(z)))}),Se(),Ee();var U=Ge(),G=m(U),J=m(G),me=y(m(J),2);{var de=t=>{var r=Te(),a=m(r);{var d=l=>{var p=De();u(l,p)},n=l=>{var p=Ne();u(l,p)};C(a,l=>{e(x)?l(d):l(n,!1)})}var i=y(a);H(()=>{r.disabled=e(x),$e(r,"title",e(x)?"Clearing files...":"Delete all files and their analyses"),S(i,` ${(e(x)?"Clearing...":"Clear All Files")??""}`)}),$("click",r,ce),u(t,r)};C(me,t=>{k().files.length>0&&t(de)})}var pe=y(J,2),K=m(pe),ue=m(K),ve=y(K,2),g=m(ve),fe=m(g),b=y(g,2),he=m(b),_=y(b,2),we=m(_),xe=y(G,2),Q=m(xe);{var ge=t=>{var r=qe();u(t,r)};C(Q,t=>{e(x)&&t(ge)})}var be=y(Q,2);{var ye=t=>{var r=Oe();u(t,r)},_e=t=>{var r=R(),a=X(r);{var d=i=>{var l=Ue(),p=m(l);H(()=>S(p,e(z)?"No matching files found.":"No files saved yet. Upload a file to get started.")),u(i,l)},n=i=>{var l=R(),p=X(l);Me(p,1,()=>e(L),B=>B.id,(B,M)=>{const Fe=D(()=>{var F;return e(M).id===((F=ee())==null?void 0:F.id)}),ke=D(()=>e(re).has(e(M).id)),ze=D(()=>e(h).get(e(M).id));He(B,{get file(){return e(M)},get isActive(){return e(Fe)},get showDetails(){return e(ke)},get preview(){return e(ze)},$$events:{select:({detail:F})=>oe(F.id),delete:({detail:F})=>ne(F.id)}})}),u(i,l)};C(a,i=>{e(L).length===0?i(d):i(n,!1)},!0)}u(t,r)};C(be,t=>{e(V)?t(ye):t(_e,!1)})}H(()=>{o(g,"bg-brand-royal",e(s)==="name"),o(g,"text-white",e(s)==="name"),o(g,"text-text-slate",e(s)!=="name"),o(g,"hover:bg-brand-whisper",e(s)!=="name"),o(g,"hover:text-brand-royal",e(s)!=="name"),S(fe,`Name ${(e(s)==="name"?e(w)==="asc"?"↑":"↓":"")??""}`),o(b,"bg-brand-royal",e(s)==="size"),o(b,"text-white",e(s)==="size"),o(b,"text-text-slate",e(s)!=="size"),o(b,"hover:bg-brand-whisper",e(s)!=="size"),o(b,"hover:text-brand-royal",e(s)!=="size"),S(he,`Size ${(e(s)==="size"?e(w)==="asc"?"↑":"↓":"")??""}`),o(_,"bg-brand-royal",e(s)==="date"),o(_,"text-white",e(s)==="date"),o(_,"text-text-slate",e(s)!=="date"),o(_,"hover:bg-brand-whisper",e(s)!=="date"),o(_,"hover:text-brand-royal",e(s)!=="date"),S(we,`Date ${(e(s)==="date"?e(w)==="asc"?"↑":"↓":"")??""}`)}),Le(ue,()=>e(z),t=>c(z,t)),$("click",g,()=>j("name")),$("click",b,()=>j("size")),$("click",_,()=>j("date")),u(Z,U),Ae(),I()}Je.__docgen={version:3,name:"FileManager.svelte",data:[{name:"onSelectFile",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"() => void"},static:!1,readonly:!1,defaultValue:"function"}],computed:[],methods:[],components:[],description:null,keywords:[],events:[],slots:[],refs:[]};export{Je as default};
